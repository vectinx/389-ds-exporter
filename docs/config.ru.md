# Конфигурационный файл

389-ds-exporter настраивается с помощью YAML-файла.
В этом файле определяются глобальные параметры, настройки HTTP-сервера, параметры подключения к LDAP и параметры логирования.

## Глобальные параметры

### collectors_default
Набор коллекторов, включаемых по умолчанию.
Возможные значения:
- `all` — включает все доступные коллекторы;
- `none` — отключает все коллекторы;
- `standard` — включает стандартный набор коллекторов.

Значение по умолчанию: `standard`

---

### ds_numsubordinate_records
Список LDAP-записей, для которых будет собираться информация о числе подчинённых записей (`numSubordinates`).
Значение по умолчанию: `[]`

---

### collectors_enabled
Список включаемых коллекторов.
Используется для включения отдельных коллекторов, если `collectors_default` не равен `all`.

---

### shutdown_timeout
Максимальное время (в секундах), которое сервер будет ждать корректного завершения работы всех ресурсов при остановке приложения.
В течение этого периода сервер перестаёт принимать новые соединения, завершает обработку текущих запросов и корректно закрывает HTTP-сервер, пул соединений LDAP и другие ресурсы.
Если таймаут превышен, оставшиеся соединения будут закрыты принудительно.
Значение `0` означает, что корректное завершение будет пропущено.

Значение по умолчанию: `5`

## HTTP-сервер

### http_listen_address
Адрес и порт, на которых сервер будет слушать входящие соединения.
Формат: `<host>:<port>`
Примеры:
- `:9389` — слушать на порту 9389 на всех интерфейсах;
- `0.0.0.0:9389` — слушать на порту 9389 на всех IPv4 интерфейсах;
- `192.168.0.10:9389` — слушать только на указанном IP.

Значение по умолчанию: `127.0.0.1:9389`

---

### http_metrics_path
HTTP-эндпоинт, по которому публикуются метрики Prometheus.
Значение по умолчанию: `/metrics`

---

### http_read_timeout
Максимальное время ожидания при чтении всего запроса, включая тело.
Нулевое или отрицательное значение означает отсутствие таймаута.
Значение по умолчанию: `10`

---

### http_write_timeout
Максимальное время ожидания при записи ответа.
Таймер сбрасывается при чтении нового заголовка запроса.
Нулевое или отрицательное значение означает отсутствие таймаута.
Значение по умолчанию: `15`

---

### http_idle_timeout
Максимальное время ожидания следующего запроса при включённых keep-alive соединениях.
Если `0`, используется значение `http_read_timeout`.
Если оба значения (`idle_timeout` и `read_timeout`) равны `0` или меньше — таймаут отсутствует.
Значение по умолчанию: `60`

---

### http_initial_read_timeout
Максимальное время ожидания от клиента первых данных после установления соединения.
Если клиент не отправил данные в этот срок, соединение закрывается.
Значение `0` отключает таймаут (ожидание бесконечно).
Значение по умолчанию: `3`

## LDAP

### ldap_server_url
Адрес LDAP-сервера в формате RFC-2255.
Примеры: `ldap://localhost:389` или `ldaps://remote-server`
Значение по умолчанию: `ldap://localhost:389`

---

### ldap_bind_dn
DN учётной записи, используемой для аутентификации на LDAP-сервере.

---

### ldap_bind_pw
Пароль от LDAP-учётной записи.

---

### ldap_pool_conn_limit
Максимальный размер пула соединений LDAP.
Рекомендуемое и стандартное значение — `4`.
Если меньше — сборщики метрик могут блокироваться при ожидании соединений, замедляя работу экспортера.
Значения выше `4` не дают эффекта, так как текущая версия экспортера не использует более 4 соединений одновременно.

Значение по умолчанию: `4`

---

### ldap_pool_get_timeout
Таймаут (в секундах) для получения соединения из пула.
Если соединение не удалось получить соединение в течение этого времени — возвращается ошибка.

Значение по умолчанию: `5`

---

### ldap_dial_timeout
Таймаут создания LDAP-соединения.
Это время не включает BIND, только открытие соединения.

Значение по умолчанию: `3`

## Логирование

### log_level
Уровень логирования.
Возможные значения: `DEBUG`, `INFO`, `WARNING`, `ERROR`
Значение по умолчанию: `INFO`

---

### log_handler
Куда выводить логи.
Возможные значения:
- `stdout` — вывод в стандартный поток;
- `file` — вывод в файл;
- `both` — одновременно в stdout и файл.

Значение по умолчанию: `both`

---

### log_file
Путь к файлу логов.
Актуален только если `log_handler` = `file` или `both`.
Рекомендуется настроить ротацию логов (например, через `logrotate`).
Значение по умолчанию: `/var/log/389-ds-exporter/exporter.log`

---

### log_stdout_format
Формат логов в stdout.
Возможные значения: `text`, `json`
- `text` — удобен для чтения и syslog;
- `json` — полезен для парсинга и отправки во внешние системы.

Значение по умолчанию: `text`

---

### log_file_format
Формат логов в файл.
Возможные значения: `text`, `json`
Применяется только если `log_handler` = `file` или `both`.

Значение по умолчанию: `json`
